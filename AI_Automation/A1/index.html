<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoodTune - Emotion-Based Music Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment@5.0.2/sentiment.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #fff;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      header {
        text-align: center;
        padding: 20px 0;
        z-index: 10;
      }

      h1 {
        font-size: 3.5rem;
        background: linear-gradient(45deg, #e94584, #0ff0fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .tagline {
        font-size: 1.2rem;
        color: #a1a8c9;
        margin-bottom: 30px;
      }

      .main-content {
        display: flex;
        flex: 1;
        gap: 30px;
        z-index: 10;
        margin-bottom: 30px;
      }

      .mood-selector {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 25px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        max-height: 600px;
      }

      .visualization {
        flex: 2;
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        min-height: 500px;
      }

      .section-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #6e88ff;
      }

      .mood-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 30px;
      }

      .mood-btn {
        padding: 15px;
        border: none;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .mood-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .mood-btn.happy {
        background: linear-gradient(45deg, #ff9a9e, #fad0c4);
        color: #333;
      }
      .mood-btn.sad {
        background: linear-gradient(45deg, #4facfe, #00f2fe);
      }
      .mood-btn.calm {
        background: linear-gradient(45deg, #6a11cb, #2575fc);
      }
      .mood-btn.energetic {
        background: linear-gradient(45deg, #f83600, #f9d423);
        color: #333;
      }
      .mood-btn.romantic {
        background: linear-gradient(45deg, #ff057c, #8d0b93);
      }
      .mood-btn.focused {
        background: linear-gradient(45deg, #0ba360, #3cba92);
      }

      .text-input {
        margin-top: 25px;
      }

      textarea {
        width: 100%;
        height: 120px;
        background: rgba(255, 255, 255, 0.07);
        border: none;
        border-radius: 12px;
        padding: 15px;
        color: #fff;
        font-size: 1rem;
        margin-bottom: 15px;
        resize: none;
      }

      textarea:focus {
        outline: 2px solid #6e88ff;
      }

      .analyze-btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 12px;
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .analyze-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }

      .player-controls {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 25px;
        margin-top: 30px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }

      .song-info {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .album-art {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        background: linear-gradient(45deg, #8e2de2, #4a00e0);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
      }

      .song-details {
        flex: 1;
      }

      .song-title {
        font-size: 1.2rem;
        margin-bottom: 5px;
      }

      .mood-indicator {
        font-size: 0.9rem;
        color: #a1a8c9;
      }

      .progress-container {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        margin: 15px 0;
        cursor: pointer;
      }

      .progress-bar {
        height: 100%;
        width: 30%;
        background: linear-gradient(90deg, #6e88ff, #ff6b6b);
        border-radius: 3px;
        transition: width 0.1s linear;
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
      }

      .control-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 10px;
        transition: all 0.3s ease;
      }

      .control-btn:hover {
        color: #6e88ff;
        transform: scale(1.1);
      }

      .play-btn {
        background: linear-gradient(45deg, #6e88ff, #ff6b6b);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 5px 15px rgba(110, 136, 255, 0.4);
      }

      .visual-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      .mood-display {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 1.2rem;
        z-index: 11;
      }

      .mood-text {
        color: #ff6b6b;
        font-weight: bold;
      }

      footer {
        text-align: center;
        padding: 20px 0;
        color: #a1a8c9;
        font-size: 0.9rem;
        z-index: 10;
      }

      @media (max-width: 900px) {
        .main-content {
          flex-direction: column;
        }

        h1 {
          font-size: 2.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>MoodTune</h1>
        <p class="tagline">Your emotion-based music experience</p>
      </header>

      <div class="main-content">
        <div class="mood-selector">
          <h2 class="section-title">Select Your Mood</h2>
          <div class="mood-buttons">
            <button class="mood-btn happy">üòä Happy</button>
            <button class="mood-btn sad">üò¢ Sad</button>
            <button class="mood-btn calm">üòå Calm</button>
            <button class="mood-btn energetic">‚ö° Energetic</button>
            <button class="mood-btn romantic">‚ù§Ô∏è Romantic</button>
            <button class="mood-btn focused">üéØ Focused</button>
          </div>

          <div class="text-input">
            <h2 class="section-title">Or Describe Your Mood</h2>
            <textarea placeholder="Type how you're feeling today..."></textarea>
            <button class="analyze-btn">Analyze My Text</button>
          </div>
        </div>

        <div class="visualization">
          <div id="visual-canvas" class="visual-canvas"></div>
          <div class="mood-display">
            Current Mood: <span class="mood-text">None</span>
          </div>
        </div>
      </div>

      <div class="player-controls">
        <div class="song-info">
          <div class="album-art">üéµ</div>
          <div class="song-details">
            <div class="song-title">Select a mood to start playing</div>
            <div class="mood-indicator">Mood: None</div>
          </div>
        </div>

        <div class="progress-container">
          <div class="progress-bar"></div>
        </div>

        <div class="controls">
          <button class="control-btn">üîÅ</button>
          <button class="control-btn">‚èÆ</button>
          <button class="play-btn control-btn">‚ñ∂</button>
          <button class="control-btn">‚è≠</button>
          <button class="control-btn">üîÄ</button>
        </div>
      </div>

      <footer>
        <p>MoodTune ¬© 2023 | Emotion-Based Music Player</p>
      </footer>
    </div>

    <script>
      // Mood to music mapping with enhanced visualization parameters
      const moodMusic = {
        happy: {
          title: "Upbeat Pop - 'Sunshine Day'",
          color: [255, 200, 100],
          energy: 0.8,
          particles: 80,
          particleSize: [3, 10],
          effects: ["bounce", "sparkle"],
        },
        sad: {
          title: "Melancholic Melodies - 'Rainy Nights'",
          color: [100, 150, 255],
          energy: 0.3,
          particles: 40,
          particleSize: [2, 6],
          effects: ["slowFall", "fade"],
        },
        calm: {
          title: "Ambient Relaxation - 'Tranquil Waters'",
          color: [100, 220, 200],
          energy: 0.4,
          particles: 60,
          particleSize: [4, 8],
          effects: ["float", "pulse"],
        },
        energetic: {
          title: "High Energy Dance - 'Electric Pulse'",
          color: [255, 100, 100],
          energy: 0.9,
          particles: 100,
          particleSize: [2, 12],
          effects: ["explode", "vibrate"],
        },
        romantic: {
          title: "Romantic Instrumentals - 'Hearts Entwined'",
          color: [255, 100, 200],
          energy: 0.6,
          particles: 70,
          particleSize: [3, 9],
          effects: ["swirl", "glow"],
        },
        focused: {
          title: "Deep Focus - 'Concentration Zone'",
          color: [150, 200, 255],
          energy: 0.5,
          particles: 50,
          particleSize: [2, 7],
          effects: ["orbit", "pulse"],
        },
      };

      // Current state
      let currentMood = null;
      let isPlaying = false;
      let progressInterval;
      let particles = [];

      // Initialize Tone.js
      const player = new Tone.Player().toDestination();
      const reverb = new Tone.Reverb(0.5).toDestination();
      const delay = new Tone.FeedbackDelay(0.2, 0.5).toDestination();
      const filter = new Tone.Filter(800, "lowpass").toDestination();

      // Connect effects chain
      player.connect(reverb);
      player.connect(delay);
      player.connect(filter);

      // Setup sentiment analyzer
      const sentiment = new Sentiment();

      // Setup p5.js canvas
      let canvas;
      function setup() {
        const canvasContainer = select(".visualization");
        const width = canvasContainer.width;
        const height = canvasContainer.height;

        canvas = createCanvas(width, height);
        canvas.parent("visual-canvas");
        colorMode(RGB);

        // Initialize particles
        initParticles();
      }

      function windowResized() {
        const canvasContainer = select(".visualization");
        const width = canvasContainer.width;
        const height = canvasContainer.height;
        resizeCanvas(width, height);
      }

      function initParticles() {
        particles = [];
        for (let i = 0; i < 100; i++) {
          particles.push({
            x: random(width),
            y: random(height),
            size: random(2, 6),
            speedX: random(-1, 1),
            speedY: random(-1, 1),
            color: [random(100, 255), random(100, 255), random(100, 255)],
          });
        }
      }

      function draw() {
        // Clear with a semi-transparent background for trailing effect
        background(26, 26, 46, 50);

        if (currentMood) {
          const moodData = moodMusic[currentMood];
          drawMoodVisualization(moodData);
        } else {
          drawIdleVisualization();
        }
      }

      function drawMoodVisualization(moodData) {
        const [r, g, b] = moodData.color;
        const energy = moodData.energy;

        // Update and draw particles
        for (let i = 0; i < particles.length; i++) {
          let p = particles[i];

          // Move particles based on mood energy
          p.x += p.speedX * energy;
          p.y += p.speedY * energy;

          // Wrap around edges
          if (p.x > width) p.x = 0;
          if (p.x < 0) p.x = width;
          if (p.y > height) p.y = 0;
          if (p.y < 0) p.y = height;

          // Draw particle
          fill(p.color[0], p.color[1], p.color[2], 200);
          noStroke();
          ellipse(p.x, p.y, p.size);
        }

        // Draw mood-specific elements
        if (currentMood === "happy") {
          drawHappyElements(r, g, b, energy);
        } else if (currentMood === "sad") {
          drawSadElements(r, g, b, energy);
        } else if (currentMood === "calm") {
          drawCalmElements(r, g, b, energy);
        } else if (currentMood === "energetic") {
          drawEnergeticElements(r, g, b, energy);
        } else if (currentMood === "romantic") {
          drawRomanticElements(r, g, b, energy);
        } else if (currentMood === "focused") {
          drawFocusedElements(r, g, b, energy);
        }
      }

      function drawHappyElements(r, g, b, energy) {
        // Smiley faces
        for (let i = 0; i < 5; i++) {
          let x = map(sin(frameCount / 30 + i), -1, 1, 50, width - 50);
          let y = map(cos(frameCount / 40 + i), -1, 1, 50, height - 50);

          // Face
          fill(255, 220, 0);
          ellipse(x, y, 40);

          // Eyes
          fill(0);
          ellipse(x - 10, y - 5, 5);
          ellipse(x + 10, y - 5, 5);

          // Smile
          noFill();
          stroke(0);
          strokeWeight(2);
          arc(x, y + 5, 20, 15, 0, PI);
        }
      }

      function drawSadElements(r, g, b, energy) {
        // Rain droplets
        for (let i = 0; i < 20; i++) {
          let x = random(width);
          let y = (frameCount * 2 + i * 20) % height;

          fill(r, g, b);
          noStroke();
          ellipse(x, y, 3, 10);
        }

        // Sad faces
        for (let i = 0; i < 3; i++) {
          let x = width / 4 + (i * width) / 2;
          let y = height / 2;

          // Face
          fill(200, 200, 200);
          ellipse(x, y, 50);

          // Eyes
          fill(0);
          ellipse(x - 10, y - 5, 5);
          ellipse(x + 10, y - 5, 5);

          // Frown
          noFill();
          stroke(0);
          strokeWeight(2);
          arc(x, y + 10, 20, 15, PI, TWO_PI);
        }
      }

      function drawCalmElements(r, g, b, energy) {
        // Gentle waves
        noFill();
        stroke(r, g, b, 150);
        strokeWeight(2);

        for (let i = 0; i < 3; i++) {
          beginShape();
          for (let x = 0; x < width; x += 20) {
            let y = height / 2 + sin(x / 100 + frameCount / 50 + i) * 20;
            vertex(x, y);
          }
          endShape();
        }

        // Floating circles
        for (let i = 0; i < 10; i++) {
          let x = width / 2 + sin(frameCount / 30 + i) * 100;
          let y = height / 2 + cos(frameCount / 40 + i) * 100;
          let size = map(sin(frameCount / 20 + i), -1, 1, 5, 20);

          fill(r, g, b, 100);
          noStroke();
          ellipse(x, y, size);
        }
      }

      function drawEnergeticElements(r, g, b, energy) {
        // Dynamic lines
        stroke(r, g, b);
        strokeWeight(2);

        for (let i = 0; i < 20; i++) {
          let x1 = random(width);
          let y1 = random(height);
          let angle = random(TWO_PI);
          let length = random(20, 100);
          let x2 = x1 + cos(angle) * length;
          let y2 = y1 + sin(angle) * length;

          line(x1, y1, x2, y2);
        }

        // Pulsing center
        let pulseSize = map(sin(frameCount / 5), -1, 1, 50, 100);
        fill(r, g, b, 100);
        noStroke();
        ellipse(width / 2, height / 2, pulseSize);
      }

      function drawRomanticElements(r, g, b, energy) {
        // Hearts
        for (let i = 0; i < 10; i++) {
          let x = map(sin(frameCount / 30 + i), -1, 1, 50, width - 50);
          let y = map(cos(frameCount / 40 + i), -1, 1, 50, height - 50);

          drawHeart(x, y, 15, r, g, b);
        }
      }

      function drawFocusedElements(r, g, b, energy) {
        // Concentric circles
        noFill();
        stroke(r, g, b);
        strokeWeight(1);

        for (let i = 0; i < 10; i++) {
          let size = i * 30 + sin(frameCount / 20) * 5;
          ellipse(width / 2, height / 2, size);
        }

        // Beams to center
        for (let i = 0; i < 8; i++) {
          let angle = (i / 8) * TWO_PI;
          let x1 = width / 2 + cos(angle) * 150;
          let y1 = height / 2 + sin(angle) * 150;

          stroke(r, g, b, 150);
          line(x1, y1, width / 2, height / 2);
        }
      }

      function drawHeart(x, y, size, r, g, b) {
        fill(r, g, b);
        noStroke();

        beginShape();
        vertex(x, y);
        bezierVertex(
          x - size,
          y - size,
          x - size * 2,
          y + size,
          x,
          y + size * 2
        );
        bezierVertex(x + size * 2, y + size, x + size, y - size, x, y);
        endShape(CLOSE);
      }

      function drawIdleVisualization() {
        // Default visualization when no mood is selected
        background(26, 26, 46, 50);

        // Gentle pulsing circles
        const pulse = sin(frameCount / 30) * 10;
        for (let i = 0; i < 5; i++) {
          const alpha = 100 - i * 20;
          const size = 100 + i * 30 + pulse;
          noFill();
          stroke(110, 136, 255, alpha);
          strokeWeight(2);
          ellipse(width / 2, height / 2, size);
        }

        // Floating particles
        for (let i = 0; i < particles.length; i++) {
          let p = particles[i];

          // Move particles
          p.x += p.speedX;
          p.y += p.speedY;

          // Wrap around edges
          if (p.x > width) p.x = 0;
          if (p.x < 0) p.x = width;
          if (p.y > height) p.y = 0;
          if (p.y < 0) p.y = height;

          // Draw particle
          fill(p.color[0], p.color[1], p.color[2], 200);
          noStroke();
          ellipse(p.x, p.y, p.size);
        }
      }

      // Mood selection handlers
      document.querySelectorAll(".mood-btn").forEach((button) => {
        button.addEventListener("click", () => {
          const mood = button.classList[1];
          setMood(mood);
        });
      });

      // Text analysis handler
      document.querySelector(".analyze-btn").addEventListener("click", () => {
        const text = document.querySelector("textarea").value;
        if (text.trim()) {
          analyzeText(text);
        }
      });

      // Play button handler
      document.querySelector(".play-btn").addEventListener("click", () => {
        if (currentMood) {
          togglePlayback();
        } else {
          alert("Please select a mood first!");
        }
      });

      function setMood(mood) {
        currentMood = mood;
        const moodData = moodMusic[mood];

        // Update UI
        document.querySelector(".mood-text").textContent =
          mood.charAt(0).toUpperCase() + mood.slice(1);
        document.querySelector(".song-title").textContent = moodData.title;
        document.querySelector(".mood-indicator").textContent = `Mood: ${
          mood.charAt(0).toUpperCase() + mood.slice(1)
        }`;

        // Change background gradient based on mood
        const [r, g, b] = moodData.color;
        document.body.style.background = `
                linear-gradient(135deg, 
                rgba(${r}, ${g}, ${b}, 0.2) 0%, 
                #16213e 100%)
            `;

        // Initialize particles for the new mood
        initParticles();

        // Simulate loading a track for this mood
        simulateLoadTrack(mood);
      }

      function analyzeText(text) {
        const result = sentiment.analyze(text);
        let mood;

        if (result.score > 2) {
          mood = "happy";
        } else if (result.score > 0) {
          mood = "calm";
        } else if (result.score > -2) {
          mood = "focused";
        } else {
          mood = "sad";
        }

        setMood(mood);
      }

      function simulateLoadTrack(mood) {
        // In a real implementation, this would load an actual audio file
        console.log(`Loading track for mood: ${mood}`);

        // Update play button to show we're ready
        isPlaying = false;
        document.querySelector(".play-btn").textContent = "‚ñ∂";

        // Reset progress bar
        document.querySelector(".progress-bar").style.width = "0%";
      }

      function togglePlayback() {
        isPlaying = !isPlaying;

        if (isPlaying) {
          // In a real implementation, this would start playback
          document.querySelector(".play-btn").textContent = "‚è∏";
          console.log(`Playing ${currentMood} track`);

          // Start a simple playback progress simulation
          simulatePlayback();
        } else {
          document.querySelector(".play-btn").textContent = "‚ñ∂";
          console.log("Playback paused");

          // Clear the progress interval
          clearInterval(progressInterval);
        }
      }

      function simulatePlayback() {
        // Clear any existing interval
        clearInterval(progressInterval);

        // Simple progress bar animation for demo purposes
        let width = 0;
        const progressBar = document.querySelector(".progress-bar");
        progressInterval = setInterval(() => {
          if (!isPlaying) {
            clearInterval(progressInterval);
            return;
          }

          width += 0.5;
          if (width > 100) width = 0;
          progressBar.style.width = `${width}%`;
        }, 100);
      }

      // Initialize p5 sketch
      new p5();
    </script>
  </body>
</html>
